<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel Financeiro</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles/style.css">
  <link rel="stylesheet" href="styles/login.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="icon" href="data:,">
</head>
<body>

  <!-- Loading View -->
  <div id="loading-view" class="auth-view" style="display: flex;">
      <div class="spinner"></div>
      <p>Carregando...</p>
  </div>

  <!-- Main Dashboard Container (hidden by default) -->
  <div class="container" style="display: none;">
    <img src="assets/logo.png" alt="Facto Logo" class="facto-logo">
    <div class="view-toggle">
      <button id="btn-expenses-main" class="active">Gastos</button>
      <button id="btn-earnings-main">Faturamento</button>
      <button id="btn-tables-main">Tabelas</button>
      <button id="btn-dev-main" style="display: none;">Dev</button>
      <button id="logout-btn" style="margin-left: auto; background-color: #E44D42;">Sair</button>
    </div>

    <!-- Gastos (Expenses) View -->
    <div id="charts-view" style="display: flex; flex-direction: column; gap: 20px;">
      <!-- All expense chart rows go here -->
    </div>

    <!-- Faturamento (Earnings) View -->
    <div id="earnings-view" style="display: none; flex-direction: column; gap: 20px;">
        <!-- All earnings chart rows go here -->
    </div>

    <!-- Tabelas (Tables) View -->
    <div id="tables-view" style="display: none; flex-direction: column; gap: 20px;">
      <div class="card">
        <div class="table-toggle-container">
          <button id="btn-summary-month" class="table-toggle-btn active">Resumo por Mês</button>
          <button id="btn-summary-department" class="table-toggle-btn">Resumo por Departamento</button>
          <button id="btn-detailed-month" class="table-toggle-btn">Detalhado por Mês</button>
          <button id="btn-detailed-department" class="table-toggle-btn">Detalhado por Departamento</button>
          <button id="btn-earnings-table" class="table-toggle-btn">Faturamento</button>
        </div>

        <div id="table-summary-month" style="display: block;"></div>
        <div id="table-summary-department" style="display: none;"></div>
        <div id="table-detailed-month" style="display: none;"></div>
        <div id="table-detailed-department" style="display: none;"></div>
        <div id="table-earnings" style="display: none;"></div>
      </div>
    </div>
    
    <!-- Dev View -->
    <div id="dev-view" style="display: none;">
        <div class="theme-card dev-container">
            <div class="dev-header">
                <div>
                    <h1 class="dev-h1">Gerenciamento de Dados</h1>
                    <p class="dev-subheading">Faça upload, edite e exclua dados do Firestore para o painel.</p>
                </div>
                <div id="status-indicator" class="status-indicator">
                    <span class="status-dot-wrapper"><span class="status-dot"></span></span>
                    Sem alterações salvas
                </div>
            </div>

            <!-- Main Tabs -->
            <div class="dev-tabs-container">
                <nav class="dev-tabs-nav">
                    <button onclick="showTab('upload')" id="tab-btn-upload" class="tab-btn active">Enviar Dados</button>
                    <button onclick="showTab('edit')" id="tab-btn-edit" class="tab-btn">Visualizar & Editar</button>
                    <button onclick="showTab('delete')" id="tab-btn-delete" class="tab-btn">Excluir Dados</button>
                </nav>
            </div>

            <!-- Tab Content -->
            <div id="tab-content">
                <!-- Upload Tab -->
                <div id="upload-tab">
                    <div class="dev-card">
                        <h3 class="dev-h3">Passo 1: Fornecer os Dados</h3>
                        <div class="dev-input-methods-tabs">
                            <nav>
                                <button onclick="showInputMethod('file')" id="input-method-btn-file" class="tab-btn active">Arquivo TSV</button>
                                <button onclick="showInputMethod('paste')" id="input-method-btn-paste" class="tab-btn">Colar Texto</button>
                            </nav>
                        </div>
                        
                        <div id="input-method-content">
                            <div id="file-input-method">
                                <div class="file-drop-zone"><div class="text-center"><svg class="mx-auto h-12 w-12 text-gray-300" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M1.5 6a2.25 2.25 0 012.25-2.25h16.5A2.25 2.25 0 0122.5 6v12a2.25 2.25 0 01-2.25 2.25H3.75A2.25 2.25 0 011.5 18V6zM3 16.06V18c0 .414.336.75.75.75h16.5A.75.75 0 0021 18v-1.94l-2.69-2.689a1.5 1.5 0 00-2.12 0l-.88.879.97.97a.75.75 0 11-1.06 1.06l-5.16-5.159a1.5 1.5 0 00-2.12 0L3 16.061zm10.125-7.81a1.125 1.125 0 112.25 0 1.125 1.125 0 01-2.25 0z" clip-rule="evenodd" /></svg><label for="file-upload" class="file-upload-label"><span>Selecione um arquivo</span><input id="file-upload" type="file" class="sr-only"></label><p class="inline">ou arraste e solte</p><p class="text-xs">TSV até 10MB</p></div></div>
                            </div>
                            <div id="paste-input-method" style="display: none;">
                                <textarea rows="8" class="dev-textarea" placeholder="Cole aqui os dados separados por tabulação..."></textarea>
                            </div>
                        </div>
                        <button onclick="openModal('validation-modal')" class="dev-btn btn-primary w-full">Processar e Validar Dados</button>
                    </div>
                </div>

                <!-- Edit Tab -->
                <div id="edit-tab" style="display: none;">
                    <div class="dev-card dev-filter-bar"><div class="dev-filter-grid"><div><label for="month-select" class="dev-label">Mês</label><select id="month-select" class="dev-select"><option>Todos os Meses</option><option>2024-07</option></select></div><div><label for="dept-select" class="dev-label">Departamento</label><select id="dept-select" class="dev-select"><option>Todos</option><option>Administrativo</option></select></div><div class="search-bar-container"><label for="search" class="dev-label">Busca</label><input type="text" id="search" placeholder="Buscar por qualquer valor..." class="dev-input"></div><button class="dev-btn btn-primary h-fit">Buscar Dados</button></div></div>
                    <div class="overflow-x-auto"><table class="dev-table"><thead><tr><th>Mês</th><th>Departamento</th><th>Total</th><th>Bonificação</th><th>Nº de Colab.</th><th>Ações</th></tr></thead><tbody><tr><td>2024-07</td><td>Administrativo</td><td contenteditable="true">R$ 25.430,50</td><td contenteditable="true">R$ 1.200,00</td><td contenteditable="true">5</td><td><button class="text-red-600">Excluir</button></td></tr></tbody></table></div>
                    <div class="dev-actions-footer"><button class="dev-btn btn-secondary">Cancelar</button><button id="save-changes-btn" class="dev-btn btn-primary" disabled>Salvar Alterações</button></div>
                </div>

                <!-- Delete Tab -->
                <div id="delete-tab" style="display: none;">
                    <div class="dev-alert-warning"><div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.21 3.03-1.742 3.03H4.42c-1.532 0-2.492-1.696-1.742-3.03l5.58-9.92zM10 13a1 1 0 100-2 1 1 0 000 2zm-1-4a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1z" clip-rule="evenodd" /></svg></div><div class="ml-3"><p>Exclusões são permanentes e não podem ser desfeitas. Tenha certeza antes de prosseguir.</p></div></div></div>
                    <div class="dev-card"><h3 class="dev-h3">Excluir Dados em Seções</h3><p class="dev-subheading mb-4">Selecione um mês e/ou departamento para excluir todos os registros associados.</p><div class="dev-filter-grid"><div><label for="del-month-select" class="dev-label">Mês</label><select id="del-month-select" class="dev-select"><option>Selecione o mês...</option></select></div><div><label for="del-dept-select" class="dev-label">Departamento</label><select id="del-dept-select" class="dev-select"><option>Selecione o depto...</option></select></div><button onclick="openModal('delete-section-modal')" class="dev-btn btn-danger h-fit">Excluir Dados Selecionados</button></div></div>
                    <div class="danger-zone"><h3 class="danger-zone-title">Área de Risco</h3><div class="danger-zone-content"><div><p class="font-semibold">Excluir Todo o Conteúdo do Banco de Dados</p><p class="text-sm">Isso excluirá permanentemente todas as coleções de despesas e receitas. Esta ação é irreversível.</p></div><button onclick="openModal('delete-all-modal')" class="dev-btn btn-danger flex-shrink-0">Excluir Todos os Dados</button></div></div>
                </div>
            </div>
        </div>

        <!-- Modals -->
        <div id="validation-modal" class="modal-backdrop"><div class="modal-content"><div class="modal-header"><h3 class="modal-title">Revisão de Dados para Upload</h3><button onclick="closeModal('validation-modal')" class="modal-close-btn">&times;</button></div><div class="modal-body"><details class="validation-group" open><summary><span><span class="validation-count-bubble bg-yellow-500">5</span>Conflitos de Dados Encontrados</span><svg class="accordion-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg></summary><div class="validation-content"><p class="mb-4">As linhas abaixo já existem no banco de dados com valores diferentes. Marque as que você deseja sobrescrever.</p><div class="space-y-2"><div class="validation-item"><div class="col-span-1"><input type="checkbox" class="dev-checkbox"></div><div class="col-span-11"><p><b>Linha 5:</b> Mês 2024-06, Depto. Comercial</p><p><b>Existente:</b> Total R$ 45.100,00 | <b>Novo:</b> <span class="font-bold text-yellow-700">R$ 48.900,00</span></p></div></div></div></div></details><details class="validation-group" open><summary><span><span class="validation-count-bubble bg-blue-500">2</span>Categorias Não Reconhecidas</span><svg class="accordion-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg></summary><div class="validation-content"><p class="mb-4">Departamentos não reconhecidos foram encontrados. Associe-os a um existente ou adicione-os como novos.</p><div class="space-y-3"><div class="category-item"><div class="font-mono text-red-600">"MKT"</div><div><select class="dev-select"><option>Associar a...</option><option>Marketing</option><option>Comercial</option></select></div><button class="dev-btn btn-tertiary">Adicionar como novo</button></div><div class="category-item"><div class="font-mono text-red-600">"Direcao"</div><div><select class="dev-select"><option>Associar a...</option><option>Diretoria</option></select></div><button class="dev-btn btn-tertiary">Adicionar como novo</button></div></div></div></details><div class="validation-summary"><h4>Resumo do Upload</h4><ul><li><b>157</b> novas linhas serão adicionadas.</li><li><b>12</b> linhas duplicadas serão ignoradas.</li><li><b>5</b> conflitos serão resolvidos conforme selecionado.</li><li><b>2</b> categorias serão corrigidas.</li></ul></div></div><div class="modal-footer"><button onclick="closeModal('validation-modal')" class="dev-btn btn-secondary">Cancelar</button><button class="dev-btn btn-success">Confirmar e Enviar</button></div></div></div>
        <div id="delete-section-modal" class="modal-backdrop"><div class="modal-dialog"><h3 class="modal-title">Confirmar Exclusão</h3><p>Tem certeza de que deseja excluir todos os dados para os critérios selecionados? Esta ação não pode ser desfeita.</p><div class="modal-footer"><button onclick="closeModal('delete-section-modal')" class="dev-btn btn-secondary">Cancelar</button><button class="dev-btn btn-danger">Sim, Excluir</button></div></div></div>
        <div id="delete-all-modal" class="modal-backdrop"><div class="modal-dialog"><h3 class="modal-title text-red-700">Cuidado Extremo Necessário!</h3><p>Você está prestes a excluir <b>TODOS</b> os dados do banco de dados. Para prosseguir, digite <code class="dev-code">EXCLUIR</code> na caixa abaixo.</p><input id="delete-confirm-input" type="text" class="dev-input" placeholder="EXCLUIR"><div class="modal-footer"><button onclick="closeModal('delete-all-modal')" class="dev-btn btn-secondary">Cancelar</button><button id="final-delete-btn" class="dev-btn btn-danger" disabled>Confirmar Exclusão</button></div></div></div>
    </div>
  </div>

  <script type="module" src="scripts/main.js"></script>
</body>
</html>
